#################################################################################################
RISK-1-6. Порушення строку оприлюднення повідомлення про внесення змін до договору про закупівлю.
#################################################################################################

***************
Суть індикатора
***************

Індикатор свідчить про: 
Невчасну публікацію замовником змін до договору.

************************************
Законодавче обґрунтування індикатора
************************************

Стаття 10. Оприлюднення інформації про закупівлю:

1. Замовник самостійно та безоплатно через авторизовані електронні майданчики оприлюднює на веб-порталі Уповноваженого органу в порядку, встановленому Уповноваженим органом та цим Законом, інформацію про закупівлю, а саме:
- повідомлення про внесення змін до договору - протягом трьох днів з дня внесення змін.


********************************
Підстава для розробки індикатора
********************************

Свідчить про ймовірне порушення вимог абзацу 8 частини 1 статті 10 Закону.
Автоматичний контроль терміном оприлюднення змін до договору відсутній в системі. 

*********************************
Методологія та алгоритм розрахунку індикатора
*********************************

Етап існування процедури
========================
Індикатор розраховується, коли процедура знаходиться на етапі *контрактингу*.


Рівень розрахунку
=================
Індикатор розраховується для переговорних процедур на рівні *контракта*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора використовуються наступні джерела даних:

- API модуля контрактинга електронної системи закупівель

Типи процедур
=============

Індикатор розраховується для договорів наступних типів процедур:

- ``negotiation`` - *переговорна процедура*
- ``negotiation.quick`` - *прискорена переговорна процедура*
- ``aboveThresholdUA`` - *відкриті торги*
- ``aboveThresholdEU`` - *відкриті торги з публікацією англійською мовою*


Типи замовників
===============

Індикатор розраховується для замовників які в системі визначені як "А — Замовник (загальний)"  -  (``general``) та "В — Замовник (спеціальний)"  -  (``special``).

Стадії договорів
================

Подія, що вмикає розрахунок індикатора
--------------------------------------

Подія, що вмикає розрахунок індикатора - перехід договору у статус ``active``.


Подія, що вимикає розрахунок індикатора
---------------------------------------

Розрахунок індикатора вимикається, коли процедура переходить в статус ``terminated``.

Статуси договорів
-----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується, якщо статус договору дорівнює ``active``.


Частота розрахунку
==================

Якщо виконані умови для розрахунку індикатора, він розраховується при кожній зміні json-документа а також один раз на добу незалежно від наявності змін у json-документі.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля контрактинга:

- ``data.changes.id``
- ``data.changes.dateSigned``
- ``data.documents.datePublished``
- ``data.documents.relatedItem``

Робота з датами
===============
Усі дати конвертуються до місцевої часової зони, враховуючи зимовий/літній час. Після конвертації залишаємо лише дату, відкидаючи час.

Кількість днів від Дати1 до Дати2 розраховуємо так: розрахунок починаємо від наступного дня від Дати1 и закінчуємо Датою2, тобто Дату1 в розрахунок не включаємо, а Дату2 в розрахунок включаємо.



Формула розрахунку
==================
1. Якщо в договорі немає змін - відсутній блок ``data.changes``, індикатор приймає значення ``-2``, розрахунок завершується.

2. Якщо в договорі є зміни, для кожної зміни ``data.changes.id`` робимо наступне.

2.1. Вибираємо дату підписання зміни до договору ``data.changes.dateSigned``.

2.2. Знаходимо усі документи, що належать до зміни - ``data.documents``, що мають ``data.documents.relatedItem=data.changes.id``.

2.3. Вибираємо дати публікації документів ``data.documents.datePublished`` з п. 2.2.

2.4. Визначаємо найранішу дату публікації зі знайдених на попередньому кроці.

2.4. Порівнюємо дату підписання зміни (п. 2.1.) та найранішу дату публікації документу зміни (п. 2.4.). Якщо між датами пройшло більше ніж 3 дні, індикатор приймає значення ``1``, розрахунок завершується.

2.5. Якщо для зміни не знайдено жодного документа, то порівнюємо дату підписання зміни (п. 2.1.) з поточною датою. Якщо між датами пройшло більше ніж 3 дні, індикатор приймає значення ``1``, розрахунок завершується.

3. Якщо ми дійшли до цього пункту, індикатор приймає значення ``0``.


Фактори, що впливають на неточність розрахунку
==============================================

Індикатор може бути спрацьований некоректно у випадках, коли представник замовника некоректно вказує дату підписання зміни до договору.
