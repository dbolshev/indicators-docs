.. _tbl_systematicBidder:

====================
tbl_systematicBidder
====================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає для кожного учасника список кодів cpv4, у процедурах по яких він вигравав, брав участь.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор учасника

- Ідентифікатор групи товарів, послуг чи робіт, розкритий до четвертого знака (cpv4). 

- Відсоток перемог учасника у процедурах по групі ідентификаторів (cpv4).

- Відсоток участей учасника у процедурах по групі ідентификаторів (cpv4).

- Дата першого контракту учасника у процедурі по групі ідентификаторів (cpv4).

Приклад того, як може виглядати аналітична таблиця:

============== ====== ================ ================ ======================
Постачальник   cpv4   Відсоток перемог Відсоток участей Дата першого контракту
-------------- ------ ---------------- ---------------- ----------------------
Постачальник 1 cpv4 1       0.1                5              дата1
Постачальник 1 cpv4 2       3                  1              дата2
Постачальник 1 cpv4 3       0                  1              дата3
Постачальник 2 cpv4 1       0.5                3              дата4
Постачальник 2 cpv4 2       10                 30             дата5
...            ...
============== ====== ================ ================ ======================

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.bids.status``

- ``data.bids.id``

- ``data.bids.tenderers.identifier.scheme``

- ``data.bids.tenderers.identifier.id``

- ``data.procurementMethodType``

- ``data.status``

- ``data.awards.status``

- ``data.awards.bid_id``

- ``data.awards.lotID``

- ``data.lots.status``

- ``data.items.relatedLot``

- ``data.items.classification.id``

- ``data.bids.lotValues.relatedLot``

-  ``data.items.relatedLot``

- ``data.contracts.dateSigned``

Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``aboveThresholdUA`` або ``aboveThresholdEU``. Процедури повинні бути завершені, тобто ``data.status = 'complete'``. Далі будемо називати їх "Процедурами".

3. З кожної процедури для кожного лота, який має статус ``data.lots.status = 'complete'`` знаходимо його cpv код ``data.items.classification.id``. Знаходимо cpv4 для кожного cpv - беремо перші 4 цифри від cpv та додаємо до них "0000".

4. Проводимо групування по всім cpv4, рахуючи всі лоти (Gropby-cpv4 Count-lots). Маємо таблицю, де для кожного cpv4 порахована кількість вдалих продажів. Нехай таблиця буде "Усі продажі за cpv4".

5. Вибираємо з "Процедур" усі тендерні пропозиції, які мають ``data.bids.status = 'active'``. Для кожної пропозиції знаходимо її автора (конкатенація ``data.bids.tenderers.identifier.scheme`` та ``data.bids.tenderers.identifier.id``).
   Для кожної пропозиції знаходимо її cpv з блоку ``data.items.classification.id"``, на який посилається ``data.bids.lotValues.relatedLot = data.items.relatedLot``.
   Знаходимо cpv4 для кожного cpv - беремо перші 4 цифри від cpv та додаємо до них "0000". Проводимо групування по всім cpv4,``bids.tenderers.identifier.scheme`` та ``bids.tenderers.identifier.id`` рахуючи всі лоти (Gropby Count-lots).
   Маємо кількість лотів по cpv4, у яких брав участь учасник. Нехай така таблиця буде називатися "Участь учасника у процедурах по cpv4"
   
6. Вибираємо з "Процедур" усі об'єкти визначення переможців, які мають ``data.awards.status = 'active'``. Для кожного об'єкта знаходимо учасника (конкатенація ``bids.tenderers.identifier.scheme`` та ``bids.tenderers.identifier.id``), на який посилається ``data.awards.bid_id = data.bids.id``.
   Для кожного об'єкта знаходимо дату підписання - найраніша дата з об'єктів ``data.contracts.dateSigned``.
   Для кожного об'єкта знаходимо cpv з блоку ``data.items.classification.id"``, на який посилається ``data.awards.lotID = data.items.relatedLot``.
   Знаходимо cpv4 для кожного ``cpv`` - беремо перші 4 цифри від ``cpv`` та додаємо до них "0000". Проводимо групування по всім ``cpv4``,``bids.tenderers.identifier.scheme`` та ``bids.tenderers.identifier.id`` рахуючи всі лоти та вибираючи найранішу дату підписання (Gropby Count-lots First-dateSigned).
   Маємо кількість лотів по cpv4, у яких виграв учасник та дату найпершого контракту за цим ``cpv4``. Нехай така таблиця буде називатися "Перемоги учасника у процедурах по cpv4".

7. Заповнюемо нашу аналітичну таблицю. Поля "Постачальник", "cpv4" та "Дата першого контракту" беремо з таблиці "Перемоги учасника у процедурах по cpv4". Поле "Відсоток перемог" заповнюємо як відношення відповідних полів з таблиць "Перемоги учасника у процедурах по cpv4" та "Усі продажі за cpv4". Поле "Відсоток участей" заповнюється як відношення відповідних полей з таблиць "Участь учасника у процедурах по cpv4" та "Усі продажі за cpv4".
