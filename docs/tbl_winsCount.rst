.. _tbl_winsCount:

=============
tbl_winsCount
=============

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає, що закупав замовник у конкретного постачальника протягом календарного року.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовника
- Ідентифікатор постачальника
- Список унікальних кодів предметів закупівлі
- Кількість уникальних предметів закупівлі

Приклад того, як може виглядати аналітична таблиця:

========== ============== ================== =====================
Замовник   Постачальник   Список кодів CPV   Кількість кодів CPV
---------- -------------- ------------------ ---------------------
Замовник 1 Постачальник 1 Список кодів CPV 1 Кількість кодів CPV 1
Замовник 1 Постачальник 2 Список кодів CPV 2 Кількість кодів CPV 2
Замовник 1 Постачальник 3 Список кодів CPV 3 Кількість кодів CPV 3
Замовник 2 Постачальник 1 Список кодів CPV 4 Кількість кодів CPV 4
Замовник 2 Постачальник 2 Список кодів CPV 5 Кількість кодів CPV 5
...            ...        ...                ...
========== ============== ================== =====================

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

- API модуля контрактинга електронної системи закупівель


Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``data.procurementMethodType``
- ``data.id``

Для розрахунку індикатора використовуються наступні поля з API модуля контрактинга:

- ``data.procuringEntity.identifier.scheme``
- ``data.procuringEntity.identifier.id``
- ``data.suppliers.identifier.scheme`` 
- ``data.suppliers.identifier.id``
- ``data.items.classification.id``
- ``data.value.amount``

Формула розрахунку
==================

1. Вибираються тільки контракти, що заключені в межах процедур, що мають типи ``data.procurementMethodType='aboveThresholdUA'`` або ``data.procurementMethodType='aboveThresholdEU'``.

2. Залишаємо тільки контракти, що були підписані у поточному році.

3. Вибираємо ідентифікатор замовника: конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``.

4. Вибираємо ідентифікатор переможця: конкатенація ``data.suppliers.identifier.scheme`` та ``data.suppliers.identifier.id``
  
5. Вибираємо коди предметів закупівлі: усі ``data.items.classification.id``

7. Проводимо групування з усіх знайдених процедур по замовнику та переможцю, рахуючи кількість унікальних кодів предметів закупівлі та збираючи унікальні коди предметів закупівлі у список.
