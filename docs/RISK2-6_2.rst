#######################################################################################################################################################################################################################
RISK2-6_2П. Не проведення конкурентних процедур закупівель при придбанні робіт - Повторювана закупівля коли замовником вже було здійснено допорогову закупівлю (звіт) з однаковим кодом предмета закупівлі (cpv), загальна сума яких дорівнює або перевищує 1,500 тис. грн.
#######################################################################################################################################################################################################################

***************
Суть індикатора
***************

Даний індикатор виявляє ситуації, Замовник проводить допорогову закупівлю робіт з сумою, що дуже близька до порогу 1500000 грн. (або 5000000 грн.). Індикатор спрацьовує, якщо протягом календарного року Замовник вже проводив закупівлі, що близькі до порогу. Тобто маємо висуку вірогідність навмисного уникання Замовником проведення відкритих торгів. 

********************************
Підстава для розробки індикатора
********************************

Цей індикатор було розроблено, щоб виявляти спроби Замовників уникати процедур відкритих торгів.

*********************************
Методологія розрахунку індикатора
*********************************

Етап існування процедури
========================
Індикатор розраховується, коли процедура знаходиться на етапі *тендерингу*.

Рівень розрахунку
=================
Індикатор розраховується на рівні *тердера*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

- Аналітична таблиця :ref:`tbl_nearThreshold`

- `API курсу валют Національного Банку України <https://bank.gov.ua/control/uk/publish/article?art_id=38441973#exchange>`_

- Транзакційна змінна :ref:`tv_subjectOfProcurement`

Типи процедур
=============

Індикатор розраховується для наступних типів процедур:

- ``reporting`` - *процедура звітування*


Типи замовників
===============

Індикатор розраховується для загальних замовників (``general``) та замовників, що здійснюють діяльність в окремих сферах господарювання (``special``).


Категорії товарів
=================

Індикатор розраховується для процедур закупівлі *робіт* відподівно до транзакційної змінної :ref:`tv_subjectOfProcurement` та :ref:`порядку визначення категоріі закупівлі за кодом Єдиного закупівельного словника<gsw_formula>`.


Стадії процедур
===============

Подія, що вмикає розрахунок індикатора
--------------------------------------
Подія, що вмикає розрахунок індикатора - перехід процедури у статус ``complete``.


Подія, що вимикає розрахунок індикатора
---------------------------------------
Розрахунок індикатора вимикається тоді, коли з моменту перехлду процедури у статус ``complete`` проходить 2 доби. 


Статуси процедур
----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується для наступних статусів процедур:
   
  - ``complete`` - процедура завершена
  


Частота розрахунку
==================

Індикатор розраховується при будь-якій зміні json-документа, що відповідає процедурі, якщо присутні всі умови для його розрахунку.

Окрім цього індикатор перераховується раз на добу незалежно від змін у json-документі, що відповідає процедурі, якщо присутні всі умови для його розрахунку.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``data.value``
- ``data.value.amount``
- ``data.value.currency``
- ``data.procuringEntity.identifier.scheme``
- ``data.procuringEntity.identifier.id``


Для розрахунку індикатора використовуються наступні транзакційні змінні:

- :ref:`tv_subjectOfProcurement`

Для розрахунку індикатора використовуються наступні поля з API курсу валют Національного Банку України:

- ``cc``
- ``rate``
- ``exchangedate``

Формула розрахунку
==================

1. Визначаємо ідентифікатор замовника - конкатенація ``data.procuringEntity.identifier.scheme`` та `data.procuringEntity.identifier.id``. Також визначаємо CPV закупівлі з трнзакційної змінної.

2. Перевіряється валюта, в якій вказана очікувана вартість процедури відповідно до поля ``data.value.currency``

  2.а) Якщо очікувана вартість указана в гривнях, тобто ``data.value.currency = 'UAH'``, то вона залишається без змін.

  2.б) Якщо очікувана вартість указана не в гривнях, то вона переводиться у гривні відповідно до курсу даної валюти до гривні за допомогою API курсу валют на дату ``data.tenderPeriod.startDate``

3. Якщо закупівлю проводить загальний замовник (``general``)

  3.а) В аналітичній таблиці шукаємо рядок, з ідентифікатором та CPV, що співпадають з нашими. Якщо такий рядок є, додаємо суму з аналітичної таблиці до нашої очікуваної вартості. Якщо сума виходить більша за 1500000 грн., то індикатор приймає значення ``1``.

  3.б) Якщо в аналітичній таблиці немає співпадіння, або сума менше 1500000 грн., індикатор приймає значення ``0``.

4. Якщо закупівлю проводить замовник, що здійснює діяльність в окремих сферах господарювання (``special``)

  4.а) В аналітичній таблиці шукаємо рядок, з ідентифікатором та CPV, що співпадають з нашими. Якщо такий рядок є, додаємо суму з аналітичної таблиці до нашої очікуваної вартості. Якщо сума виходить більша за 5000000 грн., то індикатор приймає значення ``1``.

  4.б) Якщо в аналітичній таблиці немає співпадіння, або сума менше 5000000 грн., індикатор приймає значення ``0``.

Фактори, що впливають на неточність розрахунку
==============================================

1. Індикатор може бути порахований неточно у випадках, коли організації, що не є замовниками, помилково визначають себе в системі як замовники.

2. Індикатор може бути порахований неточно у випадках, коли замовником помилково визначено валюту очікуваної вартості процедури.

3. Проблема з розподіленням коду 45
