#################################################################################################
RISK-2-14. Зміна істотних умов договору (ціни за одиницю товару).
#################################################################################################

***************
Суть індикатора
***************

Індикатор свідчить про незаконну зміну ціни договору частіше ніж один раз у 90 днів.

************************************
Законодавче обґрунтування індикатора
************************************

Зміна суми договру частіше ніж один раз на 90 днів є порушенням пп. 2, п. 5 статті 41 Закону про публічні закупівлі.


********************************
Підстава для розробки індикатора
********************************

Автоматичний контроль терміном внесення змін до договору відсутній в системі. 

*********************************
Методологія та алгоритм розрахунку індикатора
*********************************

Етап існування процедури
========================
Індикатор розраховується, коли процедура знаходиться на етапі *контрактингу*.


Рівень розрахунку
=================
Індикатор розраховується для переговорних процедур на рівні *контракта*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора використовуються наступні джерела даних:

- API модуля контрактинга електронної системи закупівель

Типи договорів
==============

Індикатор розраховується для усіх активних договорів.

Типи замовників
===============

Індикатор розраховується для замовників які в системі визначені як "А — Замовник (загальний)"  -  (``general``) та "В — Замовник (спеціальний)"  -  (``special``).

Стадії договорів
================

Подія, що вмикає розрахунок індикатора
--------------------------------------

Подія, що вмикає розрахунок індикатора - перехід договору у статус ``active``.


Подія, що вимикає розрахунок індикатора
---------------------------------------

Розрахунок індикатора вимикається, коли процедура переходить в статус ``terminated``.

Статуси договорів
-----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується, якщо статус договору дорівнює ``active``.


Частота розрахунку
==================

Якщо виконані умови для розрахунку індикатора, він розраховується при кожній зміні json-документа а також один раз на добу незалежно від наявності змін у json-документі.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля контрактинга:

- ``data.changes.id``
- ``data.changes.status``
- ``data.changes.dateSigned``
- ``data.changes.rationaleTypes``

Робота з датами
===============
Усі дати конвертуються до місцевої часової зони, враховуючи зимовий/літній час. Після конвертації залишаємо лише дату, відкидаючи час.

Кількість днів від Дати1 до Дати2 розраховуємо так: розрахунок починаємо від наступного дня від Дати1 и закінчуємо Датою2, тобто Дату1 в розрахунок не включаємо, а Дату2 в розрахунок включаємо.



Формула розрахунку
==================
1. Якщо в договорі немає змін - відсутній блок ``data.changes``, індикатор приймає значення ``-2``, розрахунок завершується.

2. Якщо в договорі є зміни, для кожної зміни ``data.changes.id`` робимо наступне.

3. Вибираємо лише ті зміни, у яких ``data.changes.status='active'`` та в масив причин ``data.changes.rationaleTypes`` містить елемент ``itemPriceVariation``. Якщо таких нема, ындикатор приймаэ значення ``-2``, розрахунок завершується. Якщо такі елементи є, то робимона ступне.

  3.1. Вибираємо всі дати підписання ``data.changes.dateSigned`` з таких елементів.
  
  3.2. Впорядковуємо дати за зростанням.
  
  3.3. Попарно перевіряємо відстань у днях між елементами списку з п. 3.2. Попарна перевірка: перевірка відстані між першим та другим елементом списку, потім між другим та третім, між третім та четвертим тощо.
  
  3.5. Якща хоч одна відстань між елементам менша за 90 днів, індикатор приймає значення ``1``, розрахунок завершується.
  
4. Якщо ми дійшли до цього пункту, індикатор приймає значення ``0``, розрахунок завершується.

Фактори, що впливають на неточність розрахунку
==============================================

Індикатор може бути спрацьований некоректно у випадках, коли представник замовника некоректно вказує дату підписання зміни до договору або некоректно вказує суть зміни в договорі.
